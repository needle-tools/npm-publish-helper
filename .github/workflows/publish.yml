name: Publish package
on:
    push:
        branches:
            - release/*

jobs:
    publish:
        runs-on: ubuntu-latest
        timeout-minutes: 5
        permissions:
          contents: write
          id-token: write
        steps:
          - uses: actions/checkout@v4

          - uses: actions/setup-node@v4
            with:
              node-version: '24'
              registry-url: 'https://registry.npmjs.org'

          - run: npm install

          - name: Publish
            run: npx . publish "." --webhook "${{ secrets.DISCORD_WEBHOOK }}" --oidc --version+hash --create-tag --tag ${{ github.ref_name }} --llm-api-key "${{ secrets.LLM_API_KEY }}"